!function(){"use strict";var e=!1;if("undefined"!=typeof process&&!process.browser){e=!0;var t=require("request".trim())}var s=!1,n=!1;try{var i=new XMLHttpRequest;"undefined"!=typeof i.withCredentials?s=!0:"XDomainRequest"in window&&(s=!0,n=!0)}catch(o){}var a=Array.prototype.indexOf,r=function(e,t){var s=0,n=e.length;if(a&&e.indexOf===a)return e.indexOf(t);for(;s<n;s++)if(e[s]===t)return s;return-1},l=function(t){return this&&this instanceof l?("string"==typeof t&&(t={key:t}),this.callback=t.callback,this.wanted=t.wanted||[],this.key=t.key,this.simpleSheet=!!t.simpleSheet,this.parseNumbers=!!t.parseNumbers,this.wait=!!t.wait,this.reverse=!!t.reverse,this.postProcess=t.postProcess,this.debug=!!t.debug,this.query=t.query||"",this.orderby=t.orderby,this.endpoint=t.endpoint||"https://spreadsheets.google.com",this.singleton=!!t.singleton,this.simple_url=!!t.simple_url,this.callbackContext=t.callbackContext,this.prettyColumnNames="undefined"==typeof t.prettyColumnNames?!t.proxy:t.prettyColumnNames,"undefined"!=typeof t.proxy&&(this.endpoint=t.proxy.replace(/\/$/,""),this.simple_url=!0,this.singleton=!0,s=!1),this.parameterize=t.parameterize||!1,this.singleton&&("undefined"!=typeof l.singleton&&this.log("WARNING! Tabletop singleton already defined"),l.singleton=this),/key=/.test(this.key)&&(this.log("You passed an old Google Docs url as the key! Attempting to parse."),this.key=this.key.match("key=(.*?)(&|#|$)")[1]),/pubhtml/.test(this.key)&&(this.log("You passed a new Google Spreadsheets url as the key! Attempting to parse."),this.key=this.key.match("d\\/(.*?)\\/pubhtml")[1]),this.key?(this.log("Initializing with key "+this.key),this.models={},this.model_names=[],this.base_json_path="/feeds/worksheets/"+this.key+"/public/basic?alt=",e||s?this.base_json_path+="json":this.base_json_path+="json-in-script",void(this.wait||this.fetch())):void this.log("You need to pass Tabletop a key!")):new l(t)};l.callbacks={},l.init=function(e){return new l(e)},l.sheets=function(){this.log("Times have changed! You'll want to use var tabletop = Tabletop.init(...); tabletop.sheets(...); instead of Tabletop.sheets(...)")},l.prototype={fetch:function(e){"undefined"!=typeof e&&(this.callback=e),this.requestData(this.base_json_path,this.loadSheets)},requestData:function(t,i){if(e)this.serverSideFetch(t,i);else{var o=this.endpoint.split("//").shift()||"http";!s||n&&o!==location.protocol?this.injectScript(t,i):this.xhrFetch(t,i)}},xhrFetch:function(e,t){var s=n?new XDomainRequest:new XMLHttpRequest;s.open("GET",this.endpoint+e);var i=this;s.onload=function(){var e;try{e=JSON.parse(s.responseText)}catch(n){console.error(n)}t.call(i,e)},s.send()},injectScript:function(e,t){var s,n=document.createElement("script");if(this.singleton)t===this.loadSheets?s="Tabletop.singleton.loadSheets":t===this.loadSheet&&(s="Tabletop.singleton.loadSheet");else{var i=this;s="tt"+ +new Date+Math.floor(1e5*Math.random()),l.callbacks[s]=function(){var e=Array.prototype.slice.call(arguments,0);t.apply(i,e),n.parentNode.removeChild(n),delete l.callbacks[s]},s="Tabletop.callbacks."+s}var o=e+"&callback="+s;this.simple_url?e.indexOf("/list/")!==-1?n.src=this.endpoint+"/"+this.key+"-"+e.split("/")[4]:n.src=this.endpoint+"/"+this.key:n.src=this.endpoint+o,this.parameterize&&(n.src=this.parameterize+encodeURIComponent(n.src)),document.getElementsByTagName("script")[0].parentNode.appendChild(n)},serverSideFetch:function(e,s){var n=this;t({url:this.endpoint+e,json:!0},function(e,t,i){return e?console.error(e):void s.call(n,i)})},isWanted:function(e){return 0===this.wanted.length||r(this.wanted,e)!==-1},data:function(){if(0!==this.model_names.length)return this.simpleSheet?(this.model_names.length>1&&this.debug&&this.log("WARNING You have more than one sheet but are using simple sheet mode! Don't blame me when something goes wrong."),this.models[this.model_names[0]].all()):this.models},addWanted:function(e){r(this.wanted,e)===-1&&this.wanted.push(e)},loadSheets:function(t){var n,i,o=[];for(this.googleSheetName=t.feed.title.$t,this.foundSheetNames=[],n=0,i=t.feed.entry.length;n<i;n++)if(this.foundSheetNames.push(t.feed.entry[n].title.$t),this.isWanted(t.feed.entry[n].content.$t)){var a=t.feed.entry[n].link.length-1,r=t.feed.entry[n].link[a].href.split("/").pop(),l="/feeds/list/"+this.key+"/"+r+"/public/values?alt=";l+=e||s?"json":"json-in-script",this.query&&(l+="&sq="+this.query),this.orderby&&(l+="&orderby=column:"+this.orderby.toLowerCase()),this.reverse&&(l+="&reverse=true"),o.push(l)}for(this.sheetsToLoad=o.length,n=0,i=o.length;n<i;n++)this.requestData(o[n],this.loadSheet)},sheets:function(e){return"undefined"==typeof e?this.models:"undefined"==typeof this.models[e]?void 0:this.models[e]},sheetReady:function(e){this.models[e.name]=e,r(this.model_names,e.name)===-1&&this.model_names.push(e.name),this.sheetsToLoad--,0===this.sheetsToLoad&&this.doCallback()},loadSheet:function(e){var t=this;new l.Model({data:e,parseNumbers:this.parseNumbers,postProcess:this.postProcess,tabletop:this,prettyColumnNames:this.prettyColumnNames,onReady:function(){t.sheetReady(this)}})},doCallback:function(){0===this.sheetsToLoad&&this.callback.apply(this.callbackContext||this,[this.data(),this])},log:function(e){this.debug&&"undefined"!=typeof console&&"undefined"!=typeof console.log&&Function.prototype.apply.apply(console.log,[console,arguments])}},l.Model=function(e){var t,s,n,i;if(this.column_names=[],this.name=e.data.feed.title.$t,this.tabletop=e.tabletop,this.elements=[],this.onReady=e.onReady,this.raw=e.data,"undefined"==typeof e.data.feed.entry)return e.tabletop.log("Missing data for "+this.name+", make sure you didn't forget column headers"),this.original_columns=[],this.elements=[],void this.onReady.call(this);for(var o in e.data.feed.entry[0])/^gsx/.test(o)&&this.column_names.push(o.replace("gsx$",""));for(this.original_columns=this.column_names,t=0,n=e.data.feed.entry.length;t<n;t++){var a=e.data.feed.entry[t],r={};for(s=0,i=this.column_names.length;s<i;s++){var l=a["gsx$"+this.column_names[s]];"undefined"!=typeof l?e.parseNumbers&&""!==l.$t&&!isNaN(l.$t)?r[this.column_names[s]]=+l.$t:r[this.column_names[s]]=l.$t:r[this.column_names[s]]=""}void 0===r.rowNumber&&(r.rowNumber=t+1),e.postProcess&&e.postProcess(r),this.elements.push(r)}e.prettyColumnNames?this.fetchPrettyColumns():this.onReady.call(this)},l.Model.prototype={all:function(){return this.elements},fetchPrettyColumns:function(){if(!this.raw.feed.link[3])return this.ready();var e=this.raw.feed.link[3].href.replace("/feeds/list/","/feeds/cells/").replace("https://spreadsheets.google.com",""),t=this;this.tabletop.requestData(e,function(e){t.loadPrettyColumns(e)})},ready:function(){this.onReady.call(this)},loadPrettyColumns:function(e){for(var t={},s=this.column_names,n=0,i=s.length;n<i;n++)"undefined"!=typeof e.feed.entry[n].content.$t?t[s[n]]=e.feed.entry[n].content.$t:t[s[n]]=s[n];this.pretty_columns=t,this.prettifyElements(),this.ready()},prettifyElements:function(){var e,t,s,n,i=[],o=[];for(t=0,n=this.column_names.length;t<n;t++)o.push(this.pretty_columns[this.column_names[t]]);for(e=0,s=this.elements.length;e<s;e++){var a={};for(t=0,n=this.column_names.length;t<n;t++){var r=this.pretty_columns[this.column_names[t]];a[r]=this.elements[e][this.column_names[t]]}i.push(a)}this.elements=i,this.column_names=o},toArray:function(){var e,t,s,n,i=[];for(e=0,s=this.elements.length;e<s;e++){var o=[];for(t=0,n=this.column_names.length;t<n;t++)o.push(this.elements[e][this.column_names[t]]);i.push(o)}return i}},"undefined"!=typeof module&&module.exports?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):window.Tabletop=l}(),function(){"use strict";angular.module("times.tabletop",[]).provider("Tabletop",function(){var e,t={callback:function(t,s){e.resolve([t,s])}};this.setTabletopOptions=function(e){t=angular.extend(t,e)},this.$get=["$q","$window",function(s,n){return e=s.defer(),n.Tabletop.init(t),e.promise}]})}(),function(){"use strict";angular.module("Site",["times.tabletop"]).config(["TabletopProvider",function(e){e.setTabletopOptions({key:"https://docs.google.com/spreadsheets/d/1uvHeB66RrTJ87hmna5SnSvBeiuCQ3PE84OLcTL6iwdI/pubhtml",simple_url:!0})}]).factory("DialoguePortfolioParser",[function(){var e={parse:function(e){var t={};return t.dialogue=[],_.each(e[0].Dialogue.elements,function(e){t.dialogue.push({possibleInput:e.possibleInput,response:e.response})}),t.portfolio=e[0].Portfolio.elements,t}};return e}]).controller("Dialogue",["$scope","Tabletop","DialoguePortfolioParser",function(e,t,s){var n;t.then(function(e){n=s.parse(e)}),e.lol="test"}])}();